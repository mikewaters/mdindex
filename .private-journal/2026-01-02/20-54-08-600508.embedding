{
  "embedding": [
    -0.0587858222424984,
    0.004659414291381836,
    -0.061751920729875565,
    0.038430240005254745,
    0.08369018882513046,
    -0.08822953701019287,
    -0.010472125373780727,
    0.04735391214489937,
    -0.055772215127944946,
    -0.008480003103613853,
    0.03229822218418121,
    -0.04737754166126251,
    0.06608564406633377,
    -0.008424230851233006,
    0.05212422460317612,
    0.06517180055379868,
    -0.030696216970682144,
    0.024903763085603714,
    -0.04831481724977493,
    -0.02670585922896862,
    0.051000192761421204,
    0.10212208330631256,
    0.02044031023979187,
    -0.02303871139883995,
    -0.025193126872181892,
    0.03920429199934006,
    -0.07166160643100739,
    0.04389109089970589,
    -0.054431185126304626,
    0.007870443165302277,
    0.05176485702395439,
    0.11686854809522629,
    -0.021652445197105408,
    0.04161309823393822,
    0.02637423388659954,
    0.04407977685332298,
    0.02431824989616871,
    -0.021624954417347908,
    -0.015571839176118374,
    -0.05305304750800133,
    -0.0013451011618599296,
    0.026622828096151352,
    -0.06624781340360641,
    -0.039513856172561646,
    -0.03693724051117897,
    -0.05692646652460098,
    -0.05272673815488815,
    -0.05806624889373779,
    -0.017913181334733963,
    -0.01122323889285326,
    -0.14953070878982544,
    -0.04056888073682785,
    -0.07546935975551605,
    0.021652881056070328,
    0.08232614398002625,
    0.06395535171031952,
    -0.042168714106082916,
    -0.056094542145729065,
    -0.021957166492938995,
    -0.09355399757623672,
    -0.04345240816473961,
    -0.011077252216637135,
    -0.07868427038192749,
    -0.014496943913400173,
    -0.0008694447460584342,
    -0.026120061054825783,
    -0.026458298787474632,
    -0.01673397235572338,
    0.12879540026187897,
    -0.0348360538482666,
    -0.0720861554145813,
    0.027922796085476875,
    -0.05331646651029587,
    0.03553001210093498,
    -0.021003304049372673,
    0.03238910809159279,
    0.0310076791793108,
    0.043248601257801056,
    -0.03320636600255966,
    -0.166439950466156,
    -0.04659575968980789,
    -0.008075198158621788,
    0.0460524819791317,
    0.04252127930521965,
    -0.028939949348568916,
    -0.06818041950464249,
    0.04139741137623787,
    -0.004105609841644764,
    0.07328994572162628,
    -0.001821969635784626,
    0.047214020043611526,
    -0.08741219341754913,
    0.014031203463673592,
    -0.014629260636866093,
    -0.02131522446870804,
    0.02626957930624485,
    0.018565338104963303,
    -0.01302417367696762,
    0.04168054834008217,
    0.1216372475028038,
    0.009433187544345856,
    -0.022533932700753212,
    -0.020757809281349182,
    -0.03341604024171829,
    -0.0068261451087892056,
    0.07598691433668137,
    -0.02598017267882824,
    0.018614614382386208,
    0.005803408566862345,
    -0.03355063870549202,
    -0.0342559739947319,
    0.008276175707578659,
    -0.04404893144965172,
    -0.11464634537696838,
    0.04191005602478981,
    0.04371435195207596,
    0.04735507816076279,
    -0.00011524587898747995,
    0.017205463722348213,
    0.06987973302602768,
    0.01789960078895092,
    0.017569120973348618,
    0.07398901879787445,
    -0.04579676315188408,
    -0.016051705926656723,
    -0.03220271319150925,
    -0.1139044389128685,
    6.830435473431466e-33,
    0.03745298460125923,
    -0.039847906678915024,
    0.010013229213654995,
    -0.01248199213296175,
    0.01710452325642109,
    0.007885748520493507,
    0.022429434582591057,
    -0.019130030646920204,
    -0.06536615639925003,
    -0.003082690993323922,
    -0.010845646262168884,
    0.06617672741413116,
    -0.10551533848047256,
    0.026843076571822166,
    0.06108167767524719,
    -0.028868768364191055,
    -0.0022395052947103977,
    0.09810786694288254,
    0.0025421518366783857,
    0.042105063796043396,
    0.04799430072307587,
    -0.003089474281296134,
    -0.021943844854831696,
    0.004869122989475727,
    0.04722877964377403,
    0.06037996709346771,
    0.002444423967972398,
    -0.04120343178510666,
    -0.006900520529597998,
    0.010870947502553463,
    -0.017923768609762192,
    -0.007975056767463684,
    0.023596549406647682,
    -0.017854269593954086,
    -0.014342308044433594,
    0.00628672307357192,
    -0.02788602188229561,
    -0.059236008673906326,
    -0.04900628328323364,
    -0.08782515674829483,
    -0.035060103982686996,
    0.016516515985131264,
    0.021183639764785767,
    -0.09565115720033646,
    -0.062164586037397385,
    -0.03846026211977005,
    -0.1031266301870346,
    0.03788728639483452,
    0.07950743287801743,
    0.031730350106954575,
    0.058214813470840454,
    -0.02010088413953781,
    0.024503987282514572,
    0.006423719692975283,
    -0.05739017203450203,
    0.017440853640437126,
    -0.008885610848665237,
    0.07899145036935806,
    0.09219618886709213,
    0.04097634181380272,
    -0.027477232739329338,
    -0.0262380950152874,
    -0.009372050873935223,
    -0.03207588568329811,
    0.09449782222509384,
    0.044775623828172684,
    0.02581702545285225,
    0.07330118119716644,
    0.0710878074169159,
    0.10806266218423843,
    -0.054881781339645386,
    0.03520811349153519,
    -0.011191810481250286,
    -0.016557831317186356,
    0.10977142304182053,
    -0.11609653383493423,
    0.01329069584608078,
    -0.07025042921304703,
    -0.032389599829912186,
    0.01945859007537365,
    -0.09919175505638123,
    0.0737103596329689,
    -0.039697930216789246,
    -0.03660294786095619,
    -0.07823801785707474,
    -0.0387750118970871,
    0.05024136230349541,
    -0.011505067348480225,
    -0.022931886836886406,
    -0.04928082972764969,
    -0.0013013301650062203,
    -0.005973796360194683,
    -0.046908166259527206,
    -0.06747935712337494,
    -0.06421501934528351,
    -6.881389480119765e-33,
    0.029176121577620506,
    -0.055501628667116165,
    0.022026436403393745,
    0.009584088809788227,
    0.024390749633312225,
    -0.06231197714805603,
    0.012022853828966618,
    0.02669345773756504,
    0.0004988319706171751,
    -0.05608378350734711,
    -0.006678223144263029,
    -0.031295616179704666,
    0.02461356669664383,
    -0.07688871771097183,
    0.06566343456506729,
    0.040750615298748016,
    -0.048267580568790436,
    -0.06556385010480881,
    -0.012904112227261066,
    0.11680997908115387,
    -0.0348135344684124,
    0.08765534311532974,
    -0.06813091784715652,
    0.06485887616872787,
    0.005192541982978582,
    -0.02379653975367546,
    0.01795862428843975,
    0.08739141374826431,
    0.03291594609618187,
    -0.04696951434016228,
    -0.0015536965802311897,
    0.07318089157342911,
    -0.18044699728488922,
    -0.05149706453084946,
    -0.04780096560716629,
    -0.050008174031972885,
    -0.0465204231441021,
    0.006086850538849831,
    -0.049481313675642014,
    0.04742889851331711,
    0.04146299883723259,
    0.10494586825370789,
    -0.08225786685943604,
    -0.0030934661626815796,
    -0.028718791902065277,
    0.009462641552090645,
    0.03089802898466587,
    0.05097515136003494,
    0.011932076886296272,
    -0.08021225035190582,
    0.043113645166158676,
    -0.057632774114608765,
    -0.043112803250551224,
    0.010825385339558125,
    -0.012083430774509907,
    -0.02836131863296032,
    0.031101642176508904,
    0.006975886411964893,
    -0.08789510279893875,
    -0.012571153230965137,
    -0.0034692655317485332,
    0.03278951346874237,
    -0.041961073875427246,
    -0.005526973400264978,
    0.05494034290313721,
    -0.028265811502933502,
    -0.08052239567041397,
    -0.03163044899702072,
    -0.07185673713684082,
    0.009688405320048332,
    -0.02334187552332878,
    0.009393855929374695,
    0.05573873221874237,
    -0.012079781852662563,
    0.04370669275522232,
    0.013052763417363167,
    0.022475767880678177,
    -0.0014808037085458636,
    0.0053847720846533775,
    0.027730228379368782,
    -0.04236583784222603,
    0.047372087836265564,
    0.050607822835445404,
    0.02881132997572422,
    -0.020774705335497856,
    0.004095526412129402,
    -0.020902717486023903,
    0.15321964025497437,
    0.021081319078803062,
    -0.04581347107887268,
    0.033805347979068756,
    -0.04506199434399605,
    0.015687907114624977,
    0.07139384746551514,
    -0.0014505817089229822,
    -5.573396322233748e-8,
    -0.07059994339942932,
    -0.02751421183347702,
    -0.0694713369011879,
    0.05089341849088669,
    0.009666254743933678,
    0.10479886084794998,
    0.04805964231491089,
    0.06020341068506241,
    -0.029357554391026497,
    -0.02751421555876732,
    0.06885011494159698,
    0.015745729207992554,
    -0.09720280021429062,
    -0.014772806316614151,
    -0.036011017858982086,
    0.017866460606455803,
    0.03936411067843437,
    0.06208398565649986,
    -0.06573164463043213,
    -0.019909115508198738,
    -0.006477631628513336,
    0.021990792825818062,
    -0.01780034601688385,
    0.007577273063361645,
    0.09269426017999649,
    0.00010751173249445856,
    -0.001042255200445652,
    0.044927261769771576,
    0.00198564026504755,
    0.03210587427020073,
    0.06157469004392624,
    -0.03216646611690521,
    -0.03797597438097,
    -0.04534245282411575,
    0.10328170657157898,
    0.03188377618789673,
    0.0458843968808651,
    0.022540559992194176,
    -0.033630482852458954,
    0.04457063227891922,
    0.0559752881526947,
    0.029578235000371933,
    -0.06663784384727478,
    0.0008460929384455085,
    0.022403007373213768,
    -0.022493286058306694,
    -0.05090613290667534,
    0.031008640304207802,
    0.0635155439376831,
    -0.010586765594780445,
    -0.004345852416008711,
    -0.04172898828983307,
    -0.035377874970436096,
    -0.028126521036028862,
    -0.008953701704740524,
    0.03918946161866188,
    0.013791797682642937,
    0.000582962587941438,
    0.009635808877646923,
    -0.06819125264883041,
    0.14109358191490173,
    -0.05349476635456085,
    0.10904771089553833,
    0.029817109927535057
  ],
  "text": "Completed exploration of both metadata modules:\n\n### Sources Module (`src/pmd/sources/metadata/`)\n**Purpose**: Load-time metadata extraction from documents\n\n**Files**:\n- `profiles.py`: Protocol + ExtractedMetadata dataclass (pure data models)\n- `parsers.py`: YAML frontmatter + inline tag extraction (parsing utilities)\n- `implementations.py`: GenericProfile, ObsidianProfile, DraftsProfile\n- `registry.py`: Profile selection by path pattern or content detection\n\n**Key Concepts**:\n- ExtractedMetadata: tags (set), source_tags (list), attributes (dict), extraction_source (str)\n- MetadataProfile protocol: extract_metadata() + normalize_tag()\n- Three profiles handle different document sources (Obsidian nested/, Drafts hyphen-, Generic flat)\n- Profiles normalize tags: lowercase, trim, handle hierarchy\n- Registry auto-detects profiles or allows explicit selection\n\n### Search Module (`src/pmd/search/metadata/`)\n**Purpose**: Query-time tag inference + document retrieval/scoring\n\n**Files**:\n- `ontology.py`: Parent-child tag hierarchy for boosting\n- `inference.py`: LexicalTagMatcher for query->tag inference\n- `retrieval.py`: TagRetriever for tag-based document search\n- `scoring.py`: apply_metadata_boost, apply_metadata_boost_v2\n- `implementations/parsers/profiles/registry.py`: SHIMS importing from sources module\n\n**Key Concepts**:\n- Ontology: Hierarchical tag relationships (parent_weight=0.7)\n  - expand_for_matching() expands query tags with ancestor weights\n  - Example: \"ml/supervised/regression\" -> {ml/supervised/regression: 1.0, ml/supervised: 0.7, ml: 0.49}\n- LexicalTagMatcher: Dictionary-based inference from queries\n  - Exact matches (confidence 1.0)\n  - Alias matches (confidence 0.9, from tag_aliases.json)\n  - Prefix matches optional (confidence 0.7)\n- TagRetriever: RRF-compatible retrieval by tags (with weighted scoring)\n- apply_metadata_boost_v2: Weighted boosting using ontology expansion\n\n### Shared Architecture\n**Common Types** (currently duplicated across shims):\n- ExtractedMetadata (sources) - used by both sides\n- MetadataProfile protocol (sources) - extraction interface\n- Parsers (sources) - shared by both\n- ProfileRegistry (sources) - used by both\n\n**Current Cross-References**:\n- Search module imports from sources for profiles/parsers/registry via shims\n- Pipeline.py imports: LexicalTagMatcher, Ontology, TagRetriever from search.metadata\n- Pipeline uses tag_matcher for query inference + metadata_repo for document tags\n\n### Ontology Hierarchy (tag_ontology.json)\nParent-child relationships with parent_weight: 0.7\nCategories: programming, machine-learning, web, devops, data\nEach has 2-3 levels of hierarchy\nExample: programming -> languages/paradigms/patterns -> specific implementations\n\n### Tag Aliases (tag_aliases.json)\nSimple mapping of synonyms -> canonical tags\nExamples: py->python, k8s->kubernetes, ml->machine-learning\nNo hierarchy in aliases, just 1:1 mappings\n\n### Integration Pattern (pipeline.py)\n```\nQuery -> LexicalTagMatcher.infer_tags() -> set[str]\n       -> Ontology.expand_for_matching() -> dict[str, float] (weighted)\n       -> apply_metadata_boost_v2() -> re-score results\n       -> OR TagRetriever.search() -> retrieve by tags (RRF compatible)\n```\n\n### Key Insights\n1. **Architectural Separation is Good**: Sources handles extraction (load-time), search handles inference/matching (query-time)\n2. **Ontology is Search-Specific**: Tag hierarchy only needed for query boosting, not for extraction\n3. **Shims Indicate Shared Code**: profiles/parsers/registry are extraction concepts, not search\n4. **Inference System Sophisticated**: Two-stage tag matching (lexical + ontology)\n5. **Weighted Scoring**: apply_metadata_boost_v2 is more sophisticated than v1\n6. **Tag Storage is Generic**: DocumentMetadataRepository stores tags in junction table, no hierarchy knowledge\n\n### Duplication Analysis\n- Profiles/parsers/registry are properly isolated in sources\n- Search correctly re-exports via shims\n- Ontology is search-specific (good)\n- LexicalTagMatcher is search-specific (good)\n- No problematic duplication, just architectural layering\n\n### What Should Be Unified\n1. ExtractedMetadata - already shared (well-designed)\n2. MetadataProfile protocol - already in sources (correct)\n3. Parsing utilities - already in sources (correct)\n4. Tag hierarchy concept - currently ONLY in ontology.json (read-only at query time, not used in extraction)\n\n### What Should Stay Separate\n1. Ontology - search/inference specific\n2. LexicalTagMatcher - search/inference specific\n3. TagRetriever - search retrieval specific\n4. Boosting functions - search scoring specific\n5. Extraction profiles - loading specific\n\nThe architecture is actually quite clean. The shims in search/metadata are just convenience imports for compatibility.",
  "sections": [
    "Project Notes",
    "Metadata Module Architecture Analysis"
  ],
  "timestamp": 1767405248600,
  "path": "/Users/mike/Develop/experiments/qmd/.private-journal/2026-01-02/20-54-08-600508.md"
}