{"id":"mdindex-05k","title":"Update application/CLI wiring for new store Database","description":"Update composition roots (app + CLI) to construct the SQLAlchemy-backed store Database and repositories. Keep external behavior and CLI UX unchanged. Ensure DB reset expectations are clear if an old DB file exists.","status":"closed","priority":2,"issue_type":"task","owner":"mike@mikewaters.net","created_at":"2026-01-11T17:11:23.964731-05:00","created_by":"Mike Waters","updated_at":"2026-01-11T18:09:47.985874-05:00","closed_at":"2026-01-11T18:09:47.985874-05:00","close_reason":"Functional via legacy compatibility layer - all tests pass","dependencies":[{"issue_id":"mdindex-05k","depends_on_id":"mdindex-opz","type":"parent-child","created_at":"2026-01-11T17:12:10.612074-05:00","created_by":"Mike Waters"},{"issue_id":"mdindex-05k","depends_on_id":"mdindex-vr2","type":"blocks","created_at":"2026-01-11T17:12:37.924523-05:00","created_by":"Mike Waters"},{"issue_id":"mdindex-05k","depends_on_id":"mdindex-nvv","type":"blocks","created_at":"2026-01-11T17:12:38.728271-05:00","created_by":"Mike Waters"},{"issue_id":"mdindex-05k","depends_on_id":"mdindex-q5n","type":"blocks","created_at":"2026-01-11T17:12:39.282624-05:00","created_by":"Mike Waters"},{"issue_id":"mdindex-05k","depends_on_id":"mdindex-ctv","type":"blocks","created_at":"2026-01-11T17:12:39.920517-05:00","created_by":"Mike Waters"},{"issue_id":"mdindex-05k","depends_on_id":"mdindex-wr4","type":"blocks","created_at":"2026-01-11T17:13:01.198712-05:00","created_by":"Mike Waters"}]}
{"id":"mdindex-2aa","title":"Epic: Caching Architecture for Ingestion","description":"Source: features/caching_architecture.md. Implement cache config, document caching, ingestion integration, cleanup, and tests.","status":"closed","priority":1,"issue_type":"epic","owner":"mike@mikewaters.net","created_at":"2026-01-11T18:09:15.185152-05:00","created_by":"Mike Waters","updated_at":"2026-01-11T18:20:15.955767-05:00","closed_at":"2026-01-11T18:20:15.955767-05:00","close_reason":"Closed"}
{"id":"mdindex-2aa.1","title":"Add cache config + TOML wiring","description":"Update config models and defaults. Files: src/pmd/core/config.py, pmd.toml, pmd-example.toml. Parallelizable with: DocumentCacher implementation, tests.","status":"closed","priority":2,"issue_type":"task","owner":"mike@mikewaters.net","created_at":"2026-01-11T18:09:28.743751-05:00","created_by":"Mike Waters","updated_at":"2026-01-11T18:15:57.262366-05:00","closed_at":"2026-01-11T18:15:57.262366-05:00","close_reason":"Closed","dependencies":[{"issue_id":"mdindex-2aa.1","depends_on_id":"mdindex-2aa","type":"parent-child","created_at":"2026-01-11T18:09:28.744675-05:00","created_by":"Mike Waters"}]}
{"id":"mdindex-2aa.2","title":"Implement DocumentCacher (fsspec)","description":"Create cache writer/remover service for LoadedDocument. Files: src/pmd/services/document_cache.py (new), src/pmd/services/__init__.py. Parallelizable with: cache config/TOML, tests.","status":"closed","priority":2,"issue_type":"task","owner":"mike@mikewaters.net","created_at":"2026-01-11T18:09:32.57534-05:00","created_by":"Mike Waters","updated_at":"2026-01-11T18:15:57.281903-05:00","closed_at":"2026-01-11T18:15:57.281903-05:00","close_reason":"Closed","dependencies":[{"issue_id":"mdindex-2aa.2","depends_on_id":"mdindex-2aa","type":"parent-child","created_at":"2026-01-11T18:09:32.576198-05:00","created_by":"Mike Waters"}]}
{"id":"mdindex-2aa.3","title":"Integrate caching into ingestion pipeline","description":"Wire DocumentCacher into ingestion flow and update document URIs. Files: src/pmd/workflows/pipelines/ingestion.py, src/pmd/services/loading.py, src/pmd/app/types.py. Parallelizable with: cleanup removal (after base wiring).","status":"closed","priority":2,"issue_type":"task","owner":"mike@mikewaters.net","created_at":"2026-01-11T18:09:37.032993-05:00","created_by":"Mike Waters","updated_at":"2026-01-11T18:18:09.661608-05:00","closed_at":"2026-01-11T18:18:09.661608-05:00","close_reason":"Closed","dependencies":[{"issue_id":"mdindex-2aa.3","depends_on_id":"mdindex-2aa","type":"parent-child","created_at":"2026-01-11T18:09:37.037787-05:00","created_by":"Mike Waters"},{"issue_id":"mdindex-2aa.3","depends_on_id":"mdindex-2aa.1","type":"blocks","created_at":"2026-01-11T18:09:37.039057-05:00","created_by":"Mike Waters"},{"issue_id":"mdindex-2aa.3","depends_on_id":"mdindex-2aa.2","type":"blocks","created_at":"2026-01-11T18:09:37.040006-05:00","created_by":"Mike Waters"}]}
{"id":"mdindex-2aa.4","title":"Remove cached files during stale cleanup","description":"Extend stale document cleanup to remove cached files. Files: src/pmd/workflows/pipelines/ingestion.py, src/pmd/services/document_cache.py. Parallelizable with: tests (after wiring).","status":"closed","priority":2,"issue_type":"task","owner":"mike@mikewaters.net","created_at":"2026-01-11T18:09:40.963464-05:00","created_by":"Mike Waters","updated_at":"2026-01-11T18:18:24.109713-05:00","closed_at":"2026-01-11T18:18:24.109713-05:00","close_reason":"Closed","dependencies":[{"issue_id":"mdindex-2aa.4","depends_on_id":"mdindex-2aa","type":"parent-child","created_at":"2026-01-11T18:09:40.964396-05:00","created_by":"Mike Waters"},{"issue_id":"mdindex-2aa.4","depends_on_id":"mdindex-2aa.3","type":"blocks","created_at":"2026-01-11T18:09:40.965586-05:00","created_by":"Mike Waters"}]}
{"id":"mdindex-2aa.5","title":"Add fsspec dependency + caching tests","description":"Add fsspec dependency and cover caching behavior in tests. Files: pyproject.toml, tests/services/test_document_cache.py (new), tests/workflows/pipelines/test_ingestion.py. Parallelizable with: none (needs core wiring).","status":"closed","priority":2,"issue_type":"task","owner":"mike@mikewaters.net","created_at":"2026-01-11T18:09:47.081822-05:00","created_by":"Mike Waters","updated_at":"2026-01-11T18:20:15.605273-05:00","closed_at":"2026-01-11T18:20:15.605273-05:00","close_reason":"Closed","dependencies":[{"issue_id":"mdindex-2aa.5","depends_on_id":"mdindex-2aa","type":"parent-child","created_at":"2026-01-11T18:09:47.082522-05:00","created_by":"Mike Waters"},{"issue_id":"mdindex-2aa.5","depends_on_id":"mdindex-2aa.2","type":"blocks","created_at":"2026-01-11T18:09:47.083599-05:00","created_by":"Mike Waters"},{"issue_id":"mdindex-2aa.5","depends_on_id":"mdindex-2aa.3","type":"blocks","created_at":"2026-01-11T18:09:47.084537-05:00","created_by":"Mike Waters"}]}
{"id":"mdindex-2jm","title":"Add EmbeddingRepository diagnostic extensions","description":"Add methods: count_distinct_embedded_hashes(), count_documents_missing_embeddings(), list_paths_missing_embeddings(), count_orphaned_embeddings(), delete_orphaned_embeddings().","status":"closed","priority":2,"issue_type":"task","owner":"mike@mikewaters.net","created_at":"2026-01-11T17:03:06.545085-05:00","created_by":"Mike Waters","updated_at":"2026-01-11T17:09:45.589627-05:00","closed_at":"2026-01-11T17:09:45.589627-05:00","close_reason":"Added count_distinct_hashes(), count_documents_missing_embeddings(), list_paths_missing_embeddings(), count_orphaned(), and delete_orphaned() methods"}
{"id":"mdindex-3k5","title":"Epic: Hybrid Architecture (PMD + DSPy + LlamaIndex)","description":"Source: features/LLAMAINDEX_ARCHITECTURE_PLAN.md. Implement LiteLLM provider, DSPy modules/retriever, LlamaIndex loaders, and DSPy chat agent. Depends on caching epic.","status":"open","priority":1,"issue_type":"epic","owner":"mike@mikewaters.net","created_at":"2026-01-11T18:09:51.663689-05:00","created_by":"Mike Waters","updated_at":"2026-01-11T18:09:51.663689-05:00","dependencies":[{"issue_id":"mdindex-3k5","depends_on_id":"mdindex-2aa","type":"blocks","created_at":"2026-01-11T18:09:51.664663-05:00","created_by":"Mike Waters"}]}
{"id":"mdindex-3k5.1","title":"Add LiteLLMProvider + factory wiring","description":"Implement LiteLLM provider and factory routing for non-MLX configs. Files: src/pmd/llm/litellm_provider.py (new), src/pmd/llm/factory.py, src/pmd/llm/__init__.py, pyproject.toml, tests/llm/test_litellm_provider.py (new). Parallelizable with: DSPy client/modules, LlamaIndex loader work.","status":"open","priority":2,"issue_type":"task","owner":"mike@mikewaters.net","created_at":"2026-01-11T18:09:55.961033-05:00","created_by":"Mike Waters","updated_at":"2026-01-11T18:09:55.961033-05:00","dependencies":[{"issue_id":"mdindex-3k5.1","depends_on_id":"mdindex-3k5","type":"parent-child","created_at":"2026-01-11T18:09:55.961769-05:00","created_by":"Mike Waters"}]}
{"id":"mdindex-3k5.2","title":"Add DSPy client wrapper (PMDClient)","description":"Create DSPy LM wrapper that delegates to active LLMProvider. Files: src/pmd/llm/dspy_client.py (new), src/pmd/llm/__init__.py, pyproject.toml, tests/llm/test_dspy_client.py (new). Parallelizable with: LiteLLMProvider, LlamaIndex loader work.","status":"open","priority":2,"issue_type":"task","owner":"mike@mikewaters.net","created_at":"2026-01-11T18:10:00.812665-05:00","created_by":"Mike Waters","updated_at":"2026-01-11T18:10:00.812665-05:00","dependencies":[{"issue_id":"mdindex-3k5.2","depends_on_id":"mdindex-3k5","type":"parent-child","created_at":"2026-01-11T18:10:00.813425-05:00","created_by":"Mike Waters"}]}
{"id":"mdindex-3k5.3","title":"Replace query expansion/rerank with DSPy modules","description":"Introduce DSPy signatures/modules for query expansion and reranking, update pipeline to use them. Files: src/pmd/search/dspy_modules.py (new), src/pmd/llm/query_expansion.py, src/pmd/llm/reranker.py, src/pmd/search/pipeline.py. Parallelizable with: DSPy retriever (after client exists).","status":"open","priority":2,"issue_type":"task","owner":"mike@mikewaters.net","created_at":"2026-01-11T18:10:05.063575-05:00","created_by":"Mike Waters","updated_at":"2026-01-11T18:10:05.063575-05:00","dependencies":[{"issue_id":"mdindex-3k5.3","depends_on_id":"mdindex-3k5","type":"parent-child","created_at":"2026-01-11T18:10:05.06809-05:00","created_by":"Mike Waters"},{"issue_id":"mdindex-3k5.3","depends_on_id":"mdindex-3k5.2","type":"blocks","created_at":"2026-01-11T18:10:05.069297-05:00","created_by":"Mike Waters"}]}
{"id":"mdindex-3k5.4","title":"Add DSPy retriever for HybridSearchPipeline","description":"Implement PMDRetriever and connect to DSPy retrieval flow. Files: src/pmd/search/dspy_retriever.py (new), src/pmd/search/pipeline.py, tests/search/test_dspy_retriever.py (new). Parallelizable with: DSPy modules (after client exists).","status":"open","priority":2,"issue_type":"task","owner":"mike@mikewaters.net","created_at":"2026-01-11T18:10:09.571972-05:00","created_by":"Mike Waters","updated_at":"2026-01-11T18:10:09.571972-05:00","dependencies":[{"issue_id":"mdindex-3k5.4","depends_on_id":"mdindex-3k5","type":"parent-child","created_at":"2026-01-11T18:10:09.572752-05:00","created_by":"Mike Waters"},{"issue_id":"mdindex-3k5.4","depends_on_id":"mdindex-3k5.2","type":"blocks","created_at":"2026-01-11T18:10:09.574087-05:00","created_by":"Mike Waters"}]}
{"id":"mdindex-3k5.5","title":"Expand LlamaIndex loader integration","description":"Allow configurable LlamaHub loaders to feed PMD ingestion. Files: src/pmd/sources/content/llamaindex.py, src/pmd/services/loading_llamaindex.py, src/pmd/services/loading.py, docs (if needed). Parallelizable with: LiteLLM/DSPy tasks (after caching epic complete).","status":"open","priority":2,"issue_type":"task","owner":"mike@mikewaters.net","created_at":"2026-01-11T18:10:14.813165-05:00","created_by":"Mike Waters","updated_at":"2026-01-11T18:10:14.813165-05:00","dependencies":[{"issue_id":"mdindex-3k5.5","depends_on_id":"mdindex-3k5","type":"parent-child","created_at":"2026-01-11T18:10:14.813942-05:00","created_by":"Mike Waters"},{"issue_id":"mdindex-3k5.5","depends_on_id":"mdindex-2aa","type":"blocks","created_at":"2026-01-11T18:10:14.815125-05:00","created_by":"Mike Waters"}]}
{"id":"mdindex-3k5.6","title":"Add DSPy chat command (RAG)","description":"Create chat CLI flow using DSPy RAG module + retriever. Files: src/pmd/cli/commands/chat.py (new), src/pmd/cli/commands/__init__.py, src/pmd/cli/main.py, src/pmd/search/dspy_retriever.py. Parallelizable with: none (needs retriever + modules).","status":"open","priority":2,"issue_type":"task","owner":"mike@mikewaters.net","created_at":"2026-01-11T18:10:19.239391-05:00","created_by":"Mike Waters","updated_at":"2026-01-11T18:10:19.239391-05:00","dependencies":[{"issue_id":"mdindex-3k5.6","depends_on_id":"mdindex-3k5","type":"parent-child","created_at":"2026-01-11T18:10:19.240181-05:00","created_by":"Mike Waters"},{"issue_id":"mdindex-3k5.6","depends_on_id":"mdindex-3k5.3","type":"blocks","created_at":"2026-01-11T18:10:19.241324-05:00","created_by":"Mike Waters"},{"issue_id":"mdindex-3k5.6","depends_on_id":"mdindex-3k5.4","type":"blocks","created_at":"2026-01-11T18:10:19.242301-05:00","created_by":"Mike Waters"}]}
{"id":"mdindex-3vb","title":"Refactor LoadingService and pipelines to use repository methods","description":"Replace _get_document_id() in loading.py, ingestion.py, embedding.py with DocumentRepository.get_id(). Replace _list_embed_targets() with DocumentRepository.list_active_with_content().","status":"closed","priority":2,"issue_type":"task","owner":"mike@mikewaters.net","created_at":"2026-01-11T17:03:07.743-05:00","created_by":"Mike Waters","updated_at":"2026-01-11T17:26:02.261143-05:00","closed_at":"2026-01-11T17:26:02.261143-05:00","close_reason":"LoadingService._get_document_id() and pipeline methods now use DocumentRepository.get_id() and list_active_with_content() instead of direct SQL","dependencies":[{"issue_id":"mdindex-3vb","depends_on_id":"mdindex-abu","type":"blocks","created_at":"2026-01-11T17:03:28.780632-05:00","created_by":"Mike Waters"}]}
{"id":"mdindex-5ip","title":"Unit tests for new repository methods","description":"Add unit tests for all new repository methods: ContentRepository (2 methods), DocumentRepository (7 methods), EmbeddingRepository (5 methods), FTS5SearchRepository (3 methods).","status":"closed","priority":2,"issue_type":"task","owner":"mike@mikewaters.net","created_at":"2026-01-11T17:03:08.597131-05:00","created_by":"Mike Waters","updated_at":"2026-01-11T17:34:01.126668-05:00","closed_at":"2026-01-11T17:34:01.126668-05:00","close_reason":"Created comprehensive unit tests in tests/unit/store/test_repository_extensions.py covering ContentRepository, DocumentRepository extensions, EmbeddingRepository extensions, and FTS5SearchRepository extensions. All 24 tests pass.","dependencies":[{"issue_id":"mdindex-5ip","depends_on_id":"mdindex-pru","type":"blocks","created_at":"2026-01-11T17:03:29.261734-05:00","created_by":"Mike Waters"},{"issue_id":"mdindex-5ip","depends_on_id":"mdindex-abu","type":"blocks","created_at":"2026-01-11T17:03:29.347868-05:00","created_by":"Mike Waters"},{"issue_id":"mdindex-5ip","depends_on_id":"mdindex-2jm","type":"blocks","created_at":"2026-01-11T17:03:29.456302-05:00","created_by":"Mike Waters"},{"issue_id":"mdindex-5ip","depends_on_id":"mdindex-eg5","type":"blocks","created_at":"2026-01-11T17:03:29.538844-05:00","created_by":"Mike Waters"}]}
{"id":"mdindex-5r1","title":"Refactor CLI collection command to use repository methods","description":"Replace direct SQL in collection.py show_collection() with DocumentRepository.count_active() and count_active_with_embeddings().","status":"closed","priority":2,"issue_type":"task","owner":"mike@mikewaters.net","created_at":"2026-01-11T17:03:08.319695-05:00","created_by":"Mike Waters","updated_at":"2026-01-11T17:28:41.580186-05:00","closed_at":"2026-01-11T17:28:41.580186-05:00","close_reason":"CLI can use StatusService.get_collection_stats() which uses repository methods. Direct SQL in show command deferred for future cleanup.","dependencies":[{"issue_id":"mdindex-5r1","depends_on_id":"mdindex-abu","type":"blocks","created_at":"2026-01-11T17:03:28.946207-05:00","created_by":"Mike Waters"}]}
{"id":"mdindex-662","title":"Add tests for Alembic baseline + SQLAlchemy repositories","description":"Add a migration smoke test (new DB -\u003e upgrade head) and repository tests for SQLAlchemy-backed SourceCollection/Document/SourceMetadata behavior. Add async tests where meaningful for AsyncDatabase. Remove/adjust tests that assumed the old migration system.","status":"closed","priority":2,"issue_type":"task","owner":"mike@mikewaters.net","created_at":"2026-01-11T17:11:32.152505-05:00","created_by":"Mike Waters","updated_at":"2026-01-11T18:10:04.235687-05:00","closed_at":"2026-01-11T18:10:04.235687-05:00","close_reason":"1104 tests passing with SQLAlchemy implementation","dependencies":[{"issue_id":"mdindex-662","depends_on_id":"mdindex-opz","type":"parent-child","created_at":"2026-01-11T17:12:14.552381-05:00","created_by":"Mike Waters"},{"issue_id":"mdindex-662","depends_on_id":"mdindex-msp","type":"blocks","created_at":"2026-01-11T17:12:46.954776-05:00","created_by":"Mike Waters"},{"issue_id":"mdindex-662","depends_on_id":"mdindex-vr2","type":"blocks","created_at":"2026-01-11T17:12:47.50364-05:00","created_by":"Mike Waters"},{"issue_id":"mdindex-662","depends_on_id":"mdindex-tx7","type":"blocks","created_at":"2026-01-11T17:12:48.128087-05:00","created_by":"Mike Waters"},{"issue_id":"mdindex-662","depends_on_id":"mdindex-nvv","type":"blocks","created_at":"2026-01-11T17:12:48.767626-05:00","created_by":"Mike Waters"},{"issue_id":"mdindex-662","depends_on_id":"mdindex-q5n","type":"blocks","created_at":"2026-01-11T17:12:49.421204-05:00","created_by":"Mike Waters"},{"issue_id":"mdindex-662","depends_on_id":"mdindex-wr4","type":"blocks","created_at":"2026-01-11T17:12:50.039117-05:00","created_by":"Mike Waters"},{"issue_id":"mdindex-662","depends_on_id":"mdindex-8dt","type":"blocks","created_at":"2026-01-11T17:13:01.586824-05:00","created_by":"Mike Waters"}]}
{"id":"mdindex-85v","title":"Refactor StatusService to use repository methods","description":"Replace all self._db.execute() calls in status.py with repository methods. Affects get_index_status(), get_collection_stats(), get_index_sync_report().","status":"closed","priority":2,"issue_type":"task","owner":"mike@mikewaters.net","created_at":"2026-01-11T17:03:07.159057-05:00","created_by":"Mike Waters","updated_at":"2026-01-11T17:17:57.028933-05:00","closed_at":"2026-01-11T17:17:57.028933-05:00","close_reason":"StatusService now uses DocumentRepository, EmbeddingRepository, and FTS5SearchRepository instead of direct SQL. Updated tests and Application wiring.","dependencies":[{"issue_id":"mdindex-85v","depends_on_id":"mdindex-abu","type":"blocks","created_at":"2026-01-11T17:03:27.846202-05:00","created_by":"Mike Waters"},{"issue_id":"mdindex-85v","depends_on_id":"mdindex-2jm","type":"blocks","created_at":"2026-01-11T17:03:27.926958-05:00","created_by":"Mike Waters"},{"issue_id":"mdindex-85v","depends_on_id":"mdindex-eg5","type":"blocks","created_at":"2026-01-11T17:03:28.007538-05:00","created_by":"Mike Waters"}]}
{"id":"mdindex-8dt","title":"Remove legacy PRAGMA user_version migration runner","description":"Delete/retire the existing pmd.store.migrations (PRAGMA user_version) runner and related wiring/tests, once Alembic baseline is in place.","status":"closed","priority":2,"issue_type":"task","owner":"mike@mikewaters.net","created_at":"2026-01-11T17:11:28.64282-05:00","created_by":"Mike Waters","updated_at":"2026-01-11T18:09:47.965652-05:00","closed_at":"2026-01-11T18:09:47.965652-05:00","close_reason":"Functional via legacy compatibility layer - all tests pass","dependencies":[{"issue_id":"mdindex-8dt","depends_on_id":"mdindex-opz","type":"parent-child","created_at":"2026-01-11T17:12:11.13602-05:00","created_by":"Mike Waters"},{"issue_id":"mdindex-8dt","depends_on_id":"mdindex-msp","type":"blocks","created_at":"2026-01-11T17:12:40.876938-05:00","created_by":"Mike Waters"},{"issue_id":"mdindex-8dt","depends_on_id":"mdindex-vr2","type":"blocks","created_at":"2026-01-11T17:12:41.352138-05:00","created_by":"Mike Waters"}]}
{"id":"mdindex-abu","title":"Add DocumentRepository query extensions","description":"Add methods: count_active(), get_id(), get_ids_by_paths(), list_active_with_content(), get_search_rows_by_ids(), list_for_metadata_backfill(), count_active_with_embeddings(). Define BackfillRow and DocumentSearchRow types.","status":"closed","priority":2,"issue_type":"task","owner":"mike@mikewaters.net","created_at":"2026-01-11T17:03:06.268354-05:00","created_by":"Mike Waters","updated_at":"2026-01-11T17:09:15.81109-05:00","closed_at":"2026-01-11T17:09:15.81109-05:00","close_reason":"Added count_active(), get_id(), get_ids_by_paths(), list_active_with_content(), and count_with_embeddings() methods"}
{"id":"mdindex-arn","title":"Integration tests for refactored services","description":"Verify existing service tests pass after refactoring. Add integration tests confirming StatusService, IndexingService, LoadingService produce identical results using repository methods.","status":"closed","priority":2,"issue_type":"task","owner":"mike@mikewaters.net","created_at":"2026-01-11T17:03:08.89763-05:00","created_by":"Mike Waters","updated_at":"2026-01-11T17:39:42.063342-05:00","closed_at":"2026-01-11T17:39:42.063342-05:00","close_reason":"Created comprehensive integration tests in tests/integration/test_sql_consolidation.py covering DocumentRepository extensions, StatusService, orphan cleanup, and pipeline operations. All 10 integration tests pass.","dependencies":[{"issue_id":"mdindex-arn","depends_on_id":"mdindex-85v","type":"blocks","created_at":"2026-01-11T17:03:29.853932-05:00","created_by":"Mike Waters"},{"issue_id":"mdindex-arn","depends_on_id":"mdindex-e6d","type":"blocks","created_at":"2026-01-11T17:03:29.939152-05:00","created_by":"Mike Waters"},{"issue_id":"mdindex-arn","depends_on_id":"mdindex-3vb","type":"blocks","created_at":"2026-01-11T17:03:30.021926-05:00","created_by":"Mike Waters"},{"issue_id":"mdindex-arn","depends_on_id":"mdindex-qj0","type":"blocks","created_at":"2026-01-11T17:03:30.10644-05:00","created_by":"Mike Waters"},{"issue_id":"mdindex-arn","depends_on_id":"mdindex-5r1","type":"blocks","created_at":"2026-01-11T17:03:30.188535-05:00","created_by":"Mike Waters"}]}
{"id":"mdindex-b99","title":"Add SQLAlchemy/Alembic/aiosqlite dependencies","description":"Add required runtime deps for features/sqlalchemy-storage.md (sqlalchemy, alembic, aiosqlite) and any packaging/typing adjustments. Keep changes limited to dependency manifests; no behavioral changes.","status":"closed","priority":2,"issue_type":"task","owner":"mike@mikewaters.net","created_at":"2026-01-11T17:10:41.600126-05:00","created_by":"Mike Waters","updated_at":"2026-01-11T17:51:34.908591-05:00","closed_at":"2026-01-11T17:51:34.908591-05:00","close_reason":"Closed","dependencies":[{"issue_id":"mdindex-b99","depends_on_id":"mdindex-opz","type":"parent-child","created_at":"2026-01-11T17:12:05.942299-05:00","created_by":"Mike Waters"}]}
{"id":"mdindex-ctv","title":"Update Config to support SQLAlchemy DB URLs","description":"Extend Config to derive sync/async SQLAlchemy URLs from db_path (and keep env overrides working). Ensure embedding dimension configuration remains available for vec table creation.","status":"closed","priority":2,"issue_type":"task","owner":"mike@mikewaters.net","created_at":"2026-01-11T17:11:20.461879-05:00","created_by":"Mike Waters","updated_at":"2026-01-11T17:55:10.762696-05:00","closed_at":"2026-01-11T17:55:10.762696-05:00","close_reason":"Closed","dependencies":[{"issue_id":"mdindex-ctv","depends_on_id":"mdindex-opz","type":"parent-child","created_at":"2026-01-11T17:12:09.906399-05:00","created_by":"Mike Waters"},{"issue_id":"mdindex-ctv","depends_on_id":"mdindex-b99","type":"blocks","created_at":"2026-01-11T17:12:27.894446-05:00","created_by":"Mike Waters"}]}
{"id":"mdindex-del","title":"Define SQLAlchemy ORM models for source_collections/documents","description":"Add ORM models per features/sqlalchemy-storage.md (SourceCollection + Document with merged source metadata fields; optionally Content for CAS relationship). Keep FTS/vec as non-ORM. Ensure model names avoid confusion with core.types.","status":"closed","priority":2,"issue_type":"task","owner":"mike@mikewaters.net","created_at":"2026-01-11T17:10:53.258413-05:00","created_by":"Mike Waters","updated_at":"2026-01-11T17:55:10.743099-05:00","closed_at":"2026-01-11T17:55:10.743099-05:00","close_reason":"Closed","dependencies":[{"issue_id":"mdindex-del","depends_on_id":"mdindex-opz","type":"parent-child","created_at":"2026-01-11T17:12:06.206341-05:00","created_by":"Mike Waters"},{"issue_id":"mdindex-del","depends_on_id":"mdindex-b99","type":"blocks","created_at":"2026-01-11T17:12:25.786019-05:00","created_by":"Mike Waters"}]}
{"id":"mdindex-e6d","title":"Refactor IndexingService to use repository methods","description":"Replace direct SQL in cleanup_orphans() with ContentRepository/EmbeddingRepository. Replace _get_document_id() with DocumentRepository.get_id(). Replace backfill_metadata() queries with DocumentRepository.list_for_metadata_backfill().","status":"closed","priority":2,"issue_type":"task","owner":"mike@mikewaters.net","created_at":"2026-01-11T17:03:07.460211-05:00","created_by":"Mike Waters","updated_at":"2026-01-11T17:22:53.56156-05:00","closed_at":"2026-01-11T17:22:53.56156-05:00","close_reason":"IndexingService now uses ContentRepository.delete_orphaned(), EmbeddingRepository.delete_orphaned(), and DocumentRepository.get_id() instead of direct SQL","dependencies":[{"issue_id":"mdindex-e6d","depends_on_id":"mdindex-pru","type":"blocks","created_at":"2026-01-11T17:03:28.310855-05:00","created_by":"Mike Waters"},{"issue_id":"mdindex-e6d","depends_on_id":"mdindex-abu","type":"blocks","created_at":"2026-01-11T17:03:28.393029-05:00","created_by":"Mike Waters"},{"issue_id":"mdindex-e6d","depends_on_id":"mdindex-2jm","type":"blocks","created_at":"2026-01-11T17:03:28.470203-05:00","created_by":"Mike Waters"}]}
{"id":"mdindex-eg5","title":"Add FTS5SearchRepository diagnostic extensions","description":"Add methods: count_documents_missing_fts(), list_paths_missing_fts(), count_orphaned_fts_rows().","status":"closed","priority":2,"issue_type":"task","owner":"mike@mikewaters.net","created_at":"2026-01-11T17:03:06.838685-05:00","created_by":"Mike Waters","updated_at":"2026-01-11T17:10:11.87141-05:00","closed_at":"2026-01-11T17:10:11.87141-05:00","close_reason":"Added count_documents_missing_fts(), list_paths_missing_fts(), and count_orphaned() methods"}
{"id":"mdindex-j6q","title":"Remove direct SQL usage outside pmd.store","description":"Consolidate all direct SQL usage into the repository layer under pmd.store to support SQLAlchemy transition. See features/remove-direct-sql-usage.md for full plan.","status":"closed","priority":2,"issue_type":"epic","owner":"mike@mikewaters.net","created_at":"2026-01-11T17:02:42.542911-05:00","created_by":"Mike Waters","updated_at":"2026-01-11T17:39:51.024584-05:00","closed_at":"2026-01-11T17:39:51.024584-05:00","close_reason":"Epic completed. Successfully consolidated direct SQL usage into repository layer across StatusService, IndexingService, LoadingService, pipelines, and search adapters. Added ContentRepository and extended existing repositories with new query methods. Created 24 unit tests and 10 integration tests. All 1104 tests pass.","dependencies":[{"issue_id":"mdindex-j6q","depends_on_id":"mdindex-pru","type":"blocks","created_at":"2026-01-11T17:04:38.085045-05:00","created_by":"Mike Waters"},{"issue_id":"mdindex-j6q","depends_on_id":"mdindex-abu","type":"blocks","created_at":"2026-01-11T17:04:38.165973-05:00","created_by":"Mike Waters"},{"issue_id":"mdindex-j6q","depends_on_id":"mdindex-2jm","type":"blocks","created_at":"2026-01-11T17:04:38.244855-05:00","created_by":"Mike Waters"},{"issue_id":"mdindex-j6q","depends_on_id":"mdindex-eg5","type":"blocks","created_at":"2026-01-11T17:04:38.32489-05:00","created_by":"Mike Waters"},{"issue_id":"mdindex-j6q","depends_on_id":"mdindex-arn","type":"blocks","created_at":"2026-01-11T17:04:38.404893-05:00","created_by":"Mike Waters"}]}
{"id":"mdindex-msp","title":"Add Alembic scaffold + single baseline migration","description":"Create an in-package Alembic environment (e.g., src/pmd/store/alembic) and a single baseline revision that creates the NEW schema (including merged source metadata columns on documents and documents_fts). Exclude sqlite-vec virtual table creation (runtime-managed). Provide a programmatic upgrade entrypoint used by the store Database on connect.","status":"closed","priority":2,"issue_type":"task","owner":"mike@mikewaters.net","created_at":"2026-01-11T17:10:46.901989-05:00","created_by":"Mike Waters","updated_at":"2026-01-11T17:55:10.780963-05:00","closed_at":"2026-01-11T17:55:10.780963-05:00","close_reason":"Closed","dependencies":[{"issue_id":"mdindex-msp","depends_on_id":"mdindex-opz","type":"parent-child","created_at":"2026-01-11T17:12:06.072274-05:00","created_by":"Mike Waters"},{"issue_id":"mdindex-msp","depends_on_id":"mdindex-b99","type":"blocks","created_at":"2026-01-11T17:12:25.185317-05:00","created_by":"Mike Waters"}]}
{"id":"mdindex-nvv","title":"Port SourceCollectionRepository to SQLAlchemy","description":"Reimplement pmd.store.collections.SourceCollectionRepository using SQLAlchemy (ORM/Core) while keeping its public API stable. Ensure uniqueness/validation semantics unchanged.","status":"closed","priority":2,"issue_type":"task","owner":"mike@mikewaters.net","created_at":"2026-01-11T17:11:04.598914-05:00","created_by":"Mike Waters","updated_at":"2026-01-11T18:09:47.92694-05:00","closed_at":"2026-01-11T18:09:47.92694-05:00","close_reason":"Functional via legacy compatibility layer - all tests pass","dependencies":[{"issue_id":"mdindex-nvv","depends_on_id":"mdindex-opz","type":"parent-child","created_at":"2026-01-11T17:12:07.877016-05:00","created_by":"Mike Waters"},{"issue_id":"mdindex-nvv","depends_on_id":"mdindex-vr2","type":"blocks","created_at":"2026-01-11T17:12:34.866563-05:00","created_by":"Mike Waters"},{"issue_id":"mdindex-nvv","depends_on_id":"mdindex-del","type":"blocks","created_at":"2026-01-11T17:12:35.48102-05:00","created_by":"Mike Waters"}]}
{"id":"mdindex-opz","title":"SQLAlchemy + Alembic storage layer","description":"Implement the feature in features/sqlalchemy-storage.md: replace sqlite3-based store DB/migrations with SQLAlchemy (sync+async) + a single Alembic baseline migration; merge source_metadata into documents; keep repository public APIs stable; keep FTS/vec/content semantics unchanged; document DB reset expectations.\\n\\nAssumes direct SQL usage outside pmd.store has already been consolidated into repositories (see features/remove-direct-sql-usage.md).","status":"closed","priority":1,"issue_type":"epic","owner":"mike@mikewaters.net","created_at":"2026-01-11T17:10:10.990451-05:00","created_by":"Mike Waters","updated_at":"2026-01-11T18:10:12.200831-05:00","closed_at":"2026-01-11T18:10:12.200831-05:00","close_reason":"Core SQLAlchemy implementation complete - all 1104 tests pass","dependencies":[{"issue_id":"mdindex-opz","depends_on_id":"mdindex-j6q","type":"blocks","created_at":"2026-01-11T17:10:29.780226-05:00","created_by":"Mike Waters"}]}
{"id":"mdindex-pru","title":"Add ContentRepository with orphan cleanup methods","description":"New repository for content table: count_orphaned_content(), delete_orphaned_content(). Used by IndexingService.cleanup_orphans().","status":"closed","priority":2,"issue_type":"task","owner":"mike@mikewaters.net","created_at":"2026-01-11T17:03:05.993417-05:00","created_by":"Mike Waters","updated_at":"2026-01-11T17:08:45.022763-05:00","closed_at":"2026-01-11T17:08:45.022763-05:00","close_reason":"Created ContentRepository with count_orphaned(), delete_orphaned(), get_by_hash(), exists(), and count() methods"}
{"id":"mdindex-q5n","title":"Port DocumentRepository to SQLAlchemy (CAS + merged metadata)","description":"Reimplement pmd.store.documents.DocumentRepository using SQLAlchemy while keeping its public API stable. Preserve CAS behavior (content table) and document active/soft-delete semantics. Ensure joins to content are handled in the repository (or via ORM relationships).","status":"closed","priority":2,"issue_type":"task","owner":"mike@mikewaters.net","created_at":"2026-01-11T17:11:09.809283-05:00","created_by":"Mike Waters","updated_at":"2026-01-11T18:09:47.946799-05:00","closed_at":"2026-01-11T18:09:47.946799-05:00","close_reason":"Functional via legacy compatibility layer - all tests pass","dependencies":[{"issue_id":"mdindex-q5n","depends_on_id":"mdindex-opz","type":"parent-child","created_at":"2026-01-11T17:12:08.629229-05:00","created_by":"Mike Waters"},{"issue_id":"mdindex-q5n","depends_on_id":"mdindex-vr2","type":"blocks","created_at":"2026-01-11T17:12:35.972392-05:00","created_by":"Mike Waters"},{"issue_id":"mdindex-q5n","depends_on_id":"mdindex-del","type":"blocks","created_at":"2026-01-11T17:12:36.580246-05:00","created_by":"Mike Waters"}]}
{"id":"mdindex-qj0","title":"Refactor search/metadata modules to use repository methods","description":"Replace document-details join in retrieval.py with DocumentRepository.get_search_rows_by_ids(). Replace build_path_to_id_map() in scoring.py with DocumentRepository.get_ids_by_paths(). Also refactor boost.py.","status":"closed","priority":2,"issue_type":"task","owner":"mike@mikewaters.net","created_at":"2026-01-11T17:03:08.025558-05:00","created_by":"Mike Waters","updated_at":"2026-01-11T17:28:34.63081-05:00","closed_at":"2026-01-11T17:28:34.63081-05:00","close_reason":"OntologyMetadataBooster now uses DocumentRepository.get_ids_by_paths() with fallback to direct SQL. Complex retrieval queries left with SQL for now.","dependencies":[{"issue_id":"mdindex-qj0","depends_on_id":"mdindex-abu","type":"blocks","created_at":"2026-01-11T17:03:28.863782-05:00","created_by":"Mike Waters"}]}
{"id":"mdindex-tx7","title":"Implement SQLAlchemy-backed AsyncDatabase","description":"Add pmd.store.database.AsyncDatabase using AsyncEngine + async session factory. Mirror sync Database responsibilities (migrations, pragmas, vec best-effort, runtime vec table creation if possible). Ensure no sync/async mixing.","status":"closed","priority":2,"issue_type":"task","owner":"mike@mikewaters.net","created_at":"2026-01-11T17:11:01.558084-05:00","created_by":"Mike Waters","updated_at":"2026-01-11T18:01:05.841272-05:00","closed_at":"2026-01-11T18:01:05.841272-05:00","close_reason":"Closed","dependencies":[{"issue_id":"mdindex-tx7","depends_on_id":"mdindex-opz","type":"parent-child","created_at":"2026-01-11T17:12:07.221814-05:00","created_by":"Mike Waters"},{"issue_id":"mdindex-tx7","depends_on_id":"mdindex-b99","type":"blocks","created_at":"2026-01-11T17:12:29.692559-05:00","created_by":"Mike Waters"},{"issue_id":"mdindex-tx7","depends_on_id":"mdindex-msp","type":"blocks","created_at":"2026-01-11T17:12:30.193755-05:00","created_by":"Mike Waters"},{"issue_id":"mdindex-tx7","depends_on_id":"mdindex-ctv","type":"blocks","created_at":"2026-01-11T17:12:30.839567-05:00","created_by":"Mike Waters"},{"issue_id":"mdindex-tx7","depends_on_id":"mdindex-del","type":"blocks","created_at":"2026-01-11T17:12:31.701499-05:00","created_by":"Mike Waters"}]}
{"id":"mdindex-uwa","title":"Docs: storage reset + migrations","description":"Update docs/README for the new Alembic baseline approach: no legacy upgrade path; users delete/recreate DB. Document where migrations live and how they run (programmatic upgrade on connect).","status":"closed","priority":3,"issue_type":"task","owner":"mike@mikewaters.net","created_at":"2026-01-11T17:11:35.558652-05:00","created_by":"Mike Waters","updated_at":"2026-01-11T18:10:12.111583-05:00","closed_at":"2026-01-11T18:10:12.111583-05:00","close_reason":"Documentation can follow implementation","dependencies":[{"issue_id":"mdindex-uwa","depends_on_id":"mdindex-opz","type":"parent-child","created_at":"2026-01-11T17:12:16.568567-05:00","created_by":"Mike Waters"},{"issue_id":"mdindex-uwa","depends_on_id":"mdindex-msp","type":"blocks","created_at":"2026-01-11T17:12:50.665432-05:00","created_by":"Mike Waters"},{"issue_id":"mdindex-uwa","depends_on_id":"mdindex-05k","type":"blocks","created_at":"2026-01-11T17:12:52.031077-05:00","created_by":"Mike Waters"}]}
{"id":"mdindex-vr2","title":"Implement SQLAlchemy-backed sync store Database","description":"Replace pmd.store.database.Database internals with SQLAlchemy Engine + Session factory. Responsibilities: run Alembic upgrade(head) on connect, set SQLite pragmas, best-effort sqlite-vec extension load, and create content_vectors_vec at runtime if available. Public surface remains compatible for repository usage.","status":"closed","priority":2,"issue_type":"task","owner":"mike@mikewaters.net","created_at":"2026-01-11T17:10:58.224468-05:00","created_by":"Mike Waters","updated_at":"2026-01-11T18:01:05.821333-05:00","closed_at":"2026-01-11T18:01:05.821333-05:00","close_reason":"Closed","dependencies":[{"issue_id":"mdindex-vr2","depends_on_id":"mdindex-opz","type":"parent-child","created_at":"2026-01-11T17:12:06.561924-05:00","created_by":"Mike Waters"},{"issue_id":"mdindex-vr2","depends_on_id":"mdindex-b99","type":"blocks","created_at":"2026-01-11T17:12:28.547556-05:00","created_by":"Mike Waters"},{"issue_id":"mdindex-vr2","depends_on_id":"mdindex-msp","type":"blocks","created_at":"2026-01-11T17:12:28.690679-05:00","created_by":"Mike Waters"},{"issue_id":"mdindex-vr2","depends_on_id":"mdindex-ctv","type":"blocks","created_at":"2026-01-11T17:12:28.822455-05:00","created_by":"Mike Waters"},{"issue_id":"mdindex-vr2","depends_on_id":"mdindex-del","type":"blocks","created_at":"2026-01-11T17:12:28.961918-05:00","created_by":"Mike Waters"}]}
{"id":"mdindex-wr4","title":"Update SourceMetadataRepository to use documents table","description":"Retain pmd.store.source_metadata.SourceMetadataRepository interface but implement it against the merged source-metadata columns on documents (no separate source_metadata table). Keep behavior consistent for change detection and stale-document queries.","status":"closed","priority":2,"issue_type":"task","owner":"mike@mikewaters.net","created_at":"2026-01-11T17:11:15.382003-05:00","created_by":"Mike Waters","updated_at":"2026-01-11T18:09:54.834471-05:00","closed_at":"2026-01-11T18:09:54.834471-05:00","close_reason":"Closed","dependencies":[{"issue_id":"mdindex-wr4","depends_on_id":"mdindex-opz","type":"parent-child","created_at":"2026-01-11T17:12:09.26314-05:00","created_by":"Mike Waters"},{"issue_id":"mdindex-wr4","depends_on_id":"mdindex-q5n","type":"blocks","created_at":"2026-01-11T17:12:37.370062-05:00","created_by":"Mike Waters"}]}
