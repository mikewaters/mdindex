{"id":"qmd-0bb","title":"Remove index_documents from CollectionRepository","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T18:41:49.381104-05:00","updated_at":"2025-12-29T18:56:57.258367-05:00","closed_at":"2025-12-29T18:56:57.258367-05:00","dependencies":[{"issue_id":"qmd-0bb","depends_on_id":"qmd-1h7","type":"blocks","created_at":"2025-12-29T18:43:12.900433-05:00","created_by":"mike"}]}
{"id":"qmd-0hh","title":"Add logging to embedding storage and retrieval","description":"Log: store/embeddings.py - embedding storage, search_vectors calls, chunk counts. llm/embeddings.py - EmbeddingGenerator.embed_document chunking, embed_query calls. Include vector dimensions and timing.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-28T21:46:10.760531-05:00","updated_at":"2025-12-28T21:59:55.061623-05:00","closed_at":"2025-12-28T21:59:55.061623-05:00","dependencies":[{"issue_id":"qmd-0hh","depends_on_id":"qmd-jjg","type":"blocks","created_at":"2025-12-28T21:46:48.109195-05:00","created_by":"mike"}]}
{"id":"qmd-0to","title":"Add documentation for custom sources","description":"Document how to create and register custom document sources.\n\n## Documentation Sections\n\n### User Guide\n- How to add HTTP collections\n- How to configure authentication\n- Troubleshooting common issues\n\n### Developer Guide\n- Implementing DocumentSource protocol\n- Creating custom EntityResolvers\n- Registering sources at runtime\n- Best practices for change detection\n\n### Examples\n```python\n# Example: Notion resolver\nclass NotionResolver:\n    def __init__(self, api_key: str):\n        self.client = NotionClient(api_key)\n    \n    def list_entities(self, resource_type: str, query: dict):\n        if resource_type == 'pages':\n            for page in self.client.search(query.get('database_id')):\n                yield EntityInfo(id=page.id, title=page.title)\n    \n    async def fetch_entity(self, resource_type: str, id: str):\n        page = await self.client.get_page(id)\n        return EntityContent(\n            content=page.to_markdown(),\n            title=page.title,\n            metadata={'last_edited': page.last_edited_time}\n        )\n\n# Register and use\nregistry.entity_resolvers.register('notion', NotionResolver(api_key))\n# Now can create: entity://notion/pages?database_id=xxx\n```\n\n## Location\n- Update existing docs or create docs/ directory\n- Add docstrings to all public APIs\n- Include in --help output for CLI","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T20:55:53.279519-05:00","updated_at":"2025-12-29T22:14:27.3517-05:00","closed_at":"2025-12-29T22:14:27.3517-05:00"}
{"id":"qmd-1b1","title":"Add logging to search pipeline and FTS operations","description":"Log: HybridSearchPipeline stages (query expansion, parallel search, RRF fusion, reranking, blending), FTS5SearchRepository searches, result counts at each stage, timing. search.py and pipeline.py.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-28T21:46:21.292436-05:00","updated_at":"2025-12-28T22:00:00.448547-05:00","closed_at":"2025-12-28T22:00:00.448547-05:00","dependencies":[{"issue_id":"qmd-1b1","depends_on_id":"qmd-jjg","type":"blocks","created_at":"2025-12-28T21:46:53.216495-05:00","created_by":"mike"}]}
{"id":"qmd-1h7","title":"Refactor CLI commands to use ServiceContainer","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T18:40:26.0252-05:00","updated_at":"2025-12-29T18:48:42.65381-05:00","closed_at":"2025-12-29T18:48:42.65381-05:00","dependencies":[{"issue_id":"qmd-1h7","depends_on_id":"qmd-gzy","type":"blocks","created_at":"2025-12-29T18:42:41.407501-05:00","created_by":"mike"},{"issue_id":"qmd-1h7","depends_on_id":"qmd-87o","type":"blocks","created_at":"2025-12-29T18:42:46.574937-05:00","created_by":"mike"},{"issue_id":"qmd-1h7","depends_on_id":"qmd-pno","type":"blocks","created_at":"2025-12-29T18:42:51.681044-05:00","created_by":"mike"}]}
{"id":"qmd-1v6","title":"Service layer refactor: abstract orchestration from CLI/repos","description":"","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-29T18:38:25.320838-05:00","updated_at":"2025-12-29T18:58:50.173046-05:00","closed_at":"2025-12-29T18:58:50.173046-05:00"}
{"id":"qmd-1y5","title":"Implement Reciprocal Rank Fusion (RRF) algorithm","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T14:17:37.666091-05:00","updated_at":"2025-12-27T14:20:09.962744-05:00","closed_at":"2025-12-27T14:20:09.962744-05:00","dependencies":[{"issue_id":"qmd-1y5","depends_on_id":"qmd-dum","type":"blocks","created_at":"2025-12-27T14:18:02.68938-05:00","created_by":"mike"}]}
{"id":"qmd-30g","title":"Write tests for source abstraction","description":"Comprehensive test coverage for the new source abstraction layer.\n\n## Test Files\n- `tests/unit/sources/test_base.py` - Protocol conformance tests\n- `tests/unit/sources/test_registry.py` - Registry routing tests\n- `tests/unit/sources/test_filesystem.py` - FileSystem source tests\n- `tests/unit/sources/test_http.py` - HTTP source tests (mocked)\n- `tests/unit/sources/test_entity.py` - Entity source tests\n- `tests/integration/test_source_indexing.py` - End-to-end tests\n\n## Test Scenarios\n\n### Registry\n- Register and resolve by scheme\n- Unknown scheme raises error\n- Case-insensitive scheme matching\n\n### FileSystemSource\n- List documents with glob pattern\n- Fetch content with various encodings\n- Handle missing files gracefully\n- Incremental change detection\n\n### HTTPSource (mocked with respx/httpx)\n- Sitemap parsing\n- ETag/Last-Modified handling\n- Auth header injection\n- Retry on transient failures\n- Rate limit handling (429)\n- HTML to markdown conversion\n\n### EntitySource\n- Resolver registration\n- URI parsing\n- Fetch delegation to resolver\n\n### Integration\n- Index filesystem collection (existing behavior)\n- Index HTTP collection end-to-end\n- Mixed collection update","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T20:55:38.277855-05:00","updated_at":"2025-12-29T22:13:10.854349-05:00","closed_at":"2025-12-29T22:13:10.854349-05:00","dependencies":[{"issue_id":"qmd-30g","depends_on_id":"qmd-p5e","type":"blocks","created_at":"2025-12-29T20:57:19.035394-05:00","created_by":"mike"},{"issue_id":"qmd-30g","depends_on_id":"qmd-bpc","type":"blocks","created_at":"2025-12-29T20:57:24.153235-05:00","created_by":"mike"},{"issue_id":"qmd-30g","depends_on_id":"qmd-lb1","type":"blocks","created_at":"2025-12-29T20:57:29.278573-05:00","created_by":"mike"}]}
{"id":"qmd-3sf","title":"Implement LM Studio LLM provider (default)","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T14:23:49.659928-05:00","updated_at":"2025-12-27T14:25:59.391627-05:00","closed_at":"2025-12-27T14:25:59.391627-05:00"}
{"id":"qmd-56o","title":"Implement actual vector storage in store_embedding()","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T17:39:50.944182-05:00","updated_at":"2025-12-27T17:43:07.476344-05:00","closed_at":"2025-12-27T17:43:07.476344-05:00","dependencies":[{"issue_id":"qmd-56o","depends_on_id":"qmd-xco","type":"blocks","created_at":"2025-12-27T17:40:15.770177-05:00","created_by":"mike"}]}
{"id":"qmd-5ms","title":"Update Collection model for source configuration","description":"Extend Collection to support different source types with type-specific configuration.\n\n## Schema Changes\n```sql\nALTER TABLE collections ADD COLUMN source_type TEXT DEFAULT 'filesystem';\nALTER TABLE collections ADD COLUMN source_config TEXT;  -- JSON blob\n```\n\n## Updated Collection Type\n```python\n@dataclass\nclass Collection:\n    id: int\n    name: str\n    # Legacy fields (kept for filesystem compatibility)\n    pwd: str\n    glob_pattern: str\n    # New source fields\n    source_type: str = 'filesystem'  # 'filesystem', 'http', 'entity'\n    source_config: dict | None = None\n    created_at: str\n    updated_at: str\n    \n    def get_source_uri(self) -\u003e str:\n        \"\"\"Compute source URI from config.\"\"\"\n        if self.source_type == 'filesystem':\n            return f'file://{self.pwd}'\n        elif self.source_type == 'http':\n            return self.source_config['base_url']\n        elif self.source_type == 'entity':\n            return self.source_config['uri']\n```\n\n## Migration Strategy\n1. Existing collections get source_type='filesystem'\n2. source_config remains NULL for filesystem (uses pwd/glob_pattern)\n3. New sources store config in source_config JSON\n\n## CollectionRepository Updates\n- Update create() to accept source_type and source_config\n- Add validation per source type\n- Keep backward-compatible create() signature for filesystem","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T20:54:38.005003-05:00","updated_at":"2025-12-29T21:27:22.469593-05:00","closed_at":"2025-12-29T21:27:22.469593-05:00"}
{"id":"qmd-5os","title":"Implement embedding generation and caching","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T14:23:59.963277-05:00","updated_at":"2025-12-27T14:27:19.733839-05:00","closed_at":"2025-12-27T14:27:19.733839-05:00","dependencies":[{"issue_id":"qmd-5os","depends_on_id":"qmd-3sf","type":"blocks","created_at":"2025-12-27T14:24:24.91172-05:00","created_by":"mike"},{"issue_id":"qmd-5os","depends_on_id":"qmd-yvl","type":"blocks","created_at":"2025-12-27T14:24:30.042259-05:00","created_by":"mike"}]}
{"id":"qmd-6fs","title":"Prevent empty chunk creation in chunking.py","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-28T23:02:44.715217-05:00","updated_at":"2025-12-28T23:36:56.324587-05:00","closed_at":"2025-12-28T23:36:56.324587-05:00"}
{"id":"qmd-7g4","title":"Add source metadata tracking table","description":"Create database schema for tracking source-specific metadata (ETags, timestamps, etc.).\n\n## Schema Addition\n```sql\nCREATE TABLE source_metadata (\n    id INTEGER PRIMARY KEY,\n    document_id INTEGER NOT NULL REFERENCES documents(id),\n    source_uri TEXT NOT NULL,\n    etag TEXT,\n    last_modified TEXT,\n    last_fetched_at TEXT NOT NULL,\n    fetch_duration_ms INTEGER,\n    http_status INTEGER,\n    content_type TEXT,\n    extra_metadata TEXT,  -- JSON blob for source-specific data\n    UNIQUE(document_id)\n);\n\nCREATE INDEX idx_source_metadata_uri ON source_metadata(source_uri);\n```\n\n## Repository\n`src/pmd/store/source_metadata.py`\n\n```python\nclass SourceMetadataRepository:\n    def upsert(self, doc_id: int, metadata: SourceMetadata) -\u003e None\n    def get_by_document(self, doc_id: int) -\u003e SourceMetadata | None\n    def get_by_uri(self, uri: str) -\u003e SourceMetadata | None\n    def needs_refresh(self, doc_id: int, max_age_seconds: int) -\u003e bool\n```\n\n## Migration\n- Add migration script to schema.py\n- Handle existing documents (no metadata = filesystem source)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T20:54:07.712819-05:00","updated_at":"2025-12-29T21:25:21.18871-05:00","closed_at":"2025-12-29T21:25:21.18871-05:00"}
{"id":"qmd-87o","title":"Create SearchService with fts/vector/hybrid methods","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T18:38:59.695299-05:00","updated_at":"2025-12-29T18:47:03.705476-05:00","closed_at":"2025-12-29T18:47:03.705476-05:00","dependencies":[{"issue_id":"qmd-87o","depends_on_id":"qmd-q74","type":"blocks","created_at":"2025-12-29T18:42:30.903268-05:00","created_by":"mike"}]}
{"id":"qmd-89l","title":"Add tests for title-only document handling","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-28T23:03:10.831042-05:00","updated_at":"2025-12-28T23:39:31.186247-05:00","closed_at":"2025-12-28T23:39:31.186247-05:00","dependencies":[{"issue_id":"qmd-89l","depends_on_id":"qmd-vsb","type":"blocks","created_at":"2025-12-28T23:03:42.185959-05:00","created_by":"mike"},{"issue_id":"qmd-89l","depends_on_id":"qmd-6fs","type":"blocks","created_at":"2025-12-28T23:03:47.576672-05:00","created_by":"mike"},{"issue_id":"qmd-89l","depends_on_id":"qmd-b2l","type":"blocks","created_at":"2025-12-28T23:03:52.941829-05:00","created_by":"mike"}]}
{"id":"qmd-8i4","title":"Keep title-only docs lexical-only (no embeddings)","description":"","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-28T23:02:17.526401-05:00","updated_at":"2025-12-28T23:39:31.187268-05:00","closed_at":"2025-12-28T23:39:31.187268-05:00"}
{"id":"qmd-8lj","title":"Implement MCP server integration","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T14:24:15.368329-05:00","updated_at":"2025-12-27T14:30:07.136447-05:00","closed_at":"2025-12-27T14:30:07.136447-05:00","dependencies":[{"issue_id":"qmd-8lj","depends_on_id":"qmd-rk0","type":"blocks","created_at":"2025-12-27T14:24:45.45496-05:00","created_by":"mike"},{"issue_id":"qmd-8lj","depends_on_id":"qmd-wvv","type":"blocks","created_at":"2025-12-27T14:24:50.593262-05:00","created_by":"mike"}]}
{"id":"qmd-9am","title":"Implement basic CLI structure and collection commands","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T14:09:16.465237-05:00","updated_at":"2025-12-27T14:16:56.480201-05:00","closed_at":"2025-12-27T14:16:56.480201-05:00","dependencies":[{"issue_id":"qmd-9am","depends_on_id":"qmd-vhe","type":"blocks","created_at":"2025-12-27T14:09:57.295083-05:00","created_by":"mike"},{"issue_id":"qmd-9am","depends_on_id":"qmd-waq","type":"blocks","created_at":"2025-12-27T14:10:02.469193-05:00","created_by":"mike"}]}
{"id":"qmd-9nv","title":"Add unit tests for service layer","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T18:42:02.973274-05:00","updated_at":"2025-12-29T19:03:48.348518-05:00","closed_at":"2025-12-29T19:03:48.348518-05:00","dependencies":[{"issue_id":"qmd-9nv","depends_on_id":"qmd-gzy","type":"blocks","created_at":"2025-12-29T18:43:18.300845-05:00","created_by":"mike"},{"issue_id":"qmd-9nv","depends_on_id":"qmd-87o","type":"blocks","created_at":"2025-12-29T18:43:23.47828-05:00","created_by":"mike"},{"issue_id":"qmd-9nv","depends_on_id":"qmd-pno","type":"blocks","created_at":"2025-12-29T18:43:28.627803-05:00","created_by":"mike"}]}
{"id":"qmd-b2l","title":"Index title as FTS body for title-only docs","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-28T23:02:57.724172-05:00","updated_at":"2025-12-28T23:37:58.853589-05:00","closed_at":"2025-12-28T23:37:58.853589-05:00","dependencies":[{"issue_id":"qmd-b2l","depends_on_id":"qmd-vas","type":"blocks","created_at":"2025-12-28T23:03:36.807091-05:00","created_by":"mike"}]}
{"id":"qmd-b2n","title":"Define DocumentSource protocol","description":"Create the core protocol/interface that all document sources must implement.\n\n## Location\n`src/pmd/sources/base.py`\n\n## Protocol Definition\n```python\nclass DocumentReference:\n    \"\"\"Reference to a document from a source.\"\"\"\n    uri: str              # Canonical URI (e.g., 'file:///path/to/doc.md')\n    path: str             # Relative path for storage\n    title: str | None     # Optional title hint\n    metadata: dict        # Source-specific metadata (etag, last-modified, etc.)\n\nclass DocumentSource(Protocol):\n    \"\"\"Protocol for document sources.\"\"\"\n    \n    def list_documents(self) -\u003e Iterator[DocumentReference]:\n        \"\"\"Enumerate available documents.\"\"\"\n        ...\n    \n    async def fetch_content(self, ref: DocumentReference) -\u003e str:\n        \"\"\"Fetch document content.\"\"\"\n        ...\n    \n    def supports_incremental(self) -\u003e bool:\n        \"\"\"Whether source supports efficient change detection.\"\"\"\n        ...\n    \n    async def check_modified(self, ref: DocumentReference, stored_hash: str) -\u003e bool:\n        \"\"\"Check if document has changed since last fetch.\"\"\"\n        ...\n```\n\n## Design Notes\n- Use Protocol (structural subtyping) not ABC for flexibility\n- Make fetch_content async to support network sources\n- DocumentReference should be serializable for caching","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T20:53:07.423334-05:00","updated_at":"2025-12-29T21:20:06.271568-05:00","closed_at":"2025-12-29T21:20:06.271568-05:00"}
{"id":"qmd-bpc","title":"Implement HTTPSource for web documents","description":"Create HTTP/HTTPS document source for fetching web content.\n\n## Location\n`src/pmd/sources/http.py`\n\n## Configuration\n```python\n@dataclass\nclass HTTPConfig:\n    base_url: str\n    # Discovery\n    sitemap_url: str | None = None\n    manifest_urls: list[str] | None = None\n    # Auth\n    auth_type: Literal['none', 'bearer', 'basic', 'api_key'] = 'none'\n    auth_token: str | None = None\n    api_key_header: str = 'X-API-Key'\n    # Behavior\n    timeout_seconds: int = 30\n    max_retries: int = 3\n    respect_robots_txt: bool = True\n    # Content\n    content_selector: str | None = None  # CSS selector for main content\n    allowed_content_types: list[str] = ['text/html', 'text/markdown', 'text/plain']\n```\n\n## Features\n1. **Discovery modes**:\n   - Sitemap.xml parsing\n   - Explicit manifest (list of URLs)\n   - Single document mode\n\n2. **Change detection**:\n   - ETag support\n   - Last-Modified header\n   - Fallback to content hash\n\n3. **Content extraction**:\n   - HTML to markdown conversion\n   - CSS selector for main content area\n   - Metadata extraction (title, description)\n\n4. **Error handling**:\n   - Retry with exponential backoff\n   - Rate limit detection (429)\n   - Connection pooling\n\n## Dependencies\n- httpx for async HTTP\n- beautifulsoup4 for HTML parsing\n- Consider markdownify for HTML-\u003eMD","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T20:53:52.792297-05:00","updated_at":"2025-12-29T21:42:03.296683-05:00","closed_at":"2025-12-29T21:42:03.296683-05:00","dependencies":[{"issue_id":"qmd-bpc","depends_on_id":"qmd-b2n","type":"blocks","created_at":"2025-12-29T20:56:27.641258-05:00","created_by":"mike"},{"issue_id":"qmd-bpc","depends_on_id":"qmd-qno","type":"blocks","created_at":"2025-12-29T20:56:32.770335-05:00","created_by":"mike"},{"issue_id":"qmd-bpc","depends_on_id":"qmd-7g4","type":"blocks","created_at":"2025-12-29T20:56:37.907547-05:00","created_by":"mike"}]}
{"id":"qmd-bpz","title":"Implement SourceRegistry for URI routing","description":"Create a registry that routes URI schemes to appropriate source implementations.\n\n## Location\n`src/pmd/sources/registry.py`\n\n## Design\n```python\nclass SourceRegistry:\n    \"\"\"Routes URI schemes to source implementations.\"\"\"\n    \n    _handlers: dict[str, type[DocumentSource]]\n    \n    def register(self, scheme: str, source_class: type[DocumentSource]) -\u003e None:\n        \"\"\"Register a source class for a URI scheme.\"\"\"\n    \n    def resolve(self, uri: str, config: SourceConfig) -\u003e DocumentSource:\n        \"\"\"Create source instance for given URI.\"\"\"\n    \n    def supported_schemes(self) -\u003e list[str]:\n        \"\"\"List registered schemes.\"\"\"\n\n# Default registry with built-in sources\ndefault_registry = SourceRegistry()\ndefault_registry.register('file', FileSystemSource)\ndefault_registry.register('http', HTTPSource)\ndefault_registry.register('https', HTTPSource)\n```\n\n## Features\n- Singleton default registry\n- Allow custom registrations at runtime\n- URI parsing with scheme extraction\n- Config validation per source type","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T20:53:22.59378-05:00","updated_at":"2025-12-29T21:21:38.218141-05:00","closed_at":"2025-12-29T21:21:38.218141-05:00","dependencies":[{"issue_id":"qmd-bpz","depends_on_id":"qmd-b2n","type":"blocks","created_at":"2025-12-29T20:56:17.354957-05:00","created_by":"mike"}]}
{"id":"qmd-c4v","title":"Implement FTS5 full-text search indexing","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T14:09:11.065564-05:00","updated_at":"2025-12-27T14:15:56.348106-05:00","closed_at":"2025-12-27T14:15:56.348106-05:00","dependencies":[{"issue_id":"qmd-c4v","depends_on_id":"qmd-waq","type":"blocks","created_at":"2025-12-27T14:09:42.883846-05:00","created_by":"mike"}]}
{"id":"qmd-c7n","title":"Add integration tests for embed_collection and vector_search","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T19:34:39.791882-05:00","updated_at":"2025-12-29T19:38:21.748531-05:00","closed_at":"2025-12-29T19:38:21.748531-05:00"}
{"id":"qmd-dum","title":"Implement vector search with sqlite-vec","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T14:17:32.511179-05:00","updated_at":"2025-12-27T14:19:19.379841-05:00","closed_at":"2025-12-27T14:19:19.379841-05:00"}
{"id":"qmd-dvq","title":"Refactor MCP server to use ServiceContainer","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T18:41:35.237411-05:00","updated_at":"2025-12-29T18:49:50.497804-05:00","closed_at":"2025-12-29T18:49:50.497804-05:00","dependencies":[{"issue_id":"qmd-dvq","depends_on_id":"qmd-gzy","type":"blocks","created_at":"2025-12-29T18:42:57.112206-05:00","created_by":"mike"},{"issue_id":"qmd-dvq","depends_on_id":"qmd-87o","type":"blocks","created_at":"2025-12-29T18:43:02.275296-05:00","created_by":"mike"},{"issue_id":"qmd-dvq","depends_on_id":"qmd-pno","type":"blocks","created_at":"2025-12-29T18:43:07.42778-05:00","created_by":"mike"}]}
{"id":"qmd-gih","title":"Add logging to database operations (database.py)","description":"Log: connect/close, extension loading (sqlite-vec), schema initialization, transaction start/commit/rollback, query execution at DEBUG level. Include timing for slow queries.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-28T21:46:02.791988-05:00","updated_at":"2025-12-28T21:49:00.952614-05:00","closed_at":"2025-12-28T21:49:00.952614-05:00","dependencies":[{"issue_id":"qmd-gih","depends_on_id":"qmd-jjg","type":"blocks","created_at":"2025-12-28T21:46:42.968841-05:00","created_by":"mike"}]}
{"id":"qmd-gks","title":"Add logging to LLM providers (mlx_provider, lm_studio, openrouter)","description":"Log: model loading/unloading, embed() calls with text length and timing, generate() calls with prompt preview and timing, rerank() calls with doc count and timing, errors with full context. Use DEBUG for verbose, INFO for operations, WARNING/ERROR for failures.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-28T21:45:57.360923-05:00","updated_at":"2025-12-28T21:59:49.594871-05:00","closed_at":"2025-12-28T21:59:49.594871-05:00","dependencies":[{"issue_id":"qmd-gks","depends_on_id":"qmd-jjg","type":"blocks","created_at":"2025-12-28T21:46:37.848477-05:00","created_by":"mike"}]}
{"id":"qmd-gwd","title":"Implement FileSystemSource (refactor existing)","description":"Extract filesystem logic from IndexingService into FileSystemSource class.\n\n## Location\n`src/pmd/sources/filesystem.py`\n\n## Current Logic to Extract\nFrom `services/indexing.py:index_collection()`:\n- Path resolution and glob pattern matching\n- File reading with encoding handling\n- Title extraction from markdown\n- Change detection via hash comparison\n\n## Implementation\n```python\n@dataclass\nclass FileSystemConfig:\n    base_path: Path\n    glob_pattern: str = '**/*.md'\n    encoding: str = 'utf-8'\n\nclass FileSystemSource:\n    def __init__(self, config: FileSystemConfig):\n        self.config = config\n    \n    def list_documents(self) -\u003e Iterator[DocumentReference]:\n        for file_path in self.config.base_path.glob(self.config.glob_pattern):\n            if file_path.is_file():\n                yield DocumentReference(\n                    uri=file_path.as_uri(),\n                    path=str(file_path.relative_to(self.config.base_path)),\n                    ...\n                )\n    \n    async def fetch_content(self, ref: DocumentReference) -\u003e str:\n        # Read file, handle encoding errors\n        ...\n```\n\n## Backward Compatibility\n- Existing collections with pwd/glob_pattern continue to work\n- IndexingService delegates to FileSystemSource internally","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T20:53:37.737812-05:00","updated_at":"2025-12-29T21:23:47.438861-05:00","closed_at":"2025-12-29T21:23:47.438861-05:00","dependencies":[{"issue_id":"qmd-gwd","depends_on_id":"qmd-b2n","type":"blocks","created_at":"2025-12-29T20:56:22.478844-05:00","created_by":"mike"}]}
{"id":"qmd-gzy","title":"Create IndexingService with index/embed/cleanup methods","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T18:38:50.033166-05:00","updated_at":"2025-12-29T18:47:03.704503-05:00","closed_at":"2025-12-29T18:47:03.704503-05:00","dependencies":[{"issue_id":"qmd-gzy","depends_on_id":"qmd-q74","type":"blocks","created_at":"2025-12-29T18:42:25.831514-05:00","created_by":"mike"}]}
{"id":"qmd-jb6","title":"Add unit tests for vector-dependent service methods","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T19:34:34.320428-05:00","updated_at":"2025-12-29T19:36:37.328794-05:00","closed_at":"2025-12-29T19:36:37.328794-05:00"}
{"id":"qmd-jjg","title":"Add loguru logging infrastructure with CLI log-level option","description":"Add --log-level/-L global option to CLI (DEBUG/INFO/WARNING/ERROR). Configure loguru in main.py with proper formatting. Create a logger setup module if needed.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-28T21:45:51.8999-05:00","updated_at":"2025-12-28T21:47:45.081371-05:00","closed_at":"2025-12-28T21:47:45.081371-05:00"}
{"id":"qmd-lb1","title":"Implement EntitySource with resolver registry","description":"Create pluggable entity URI resolver for custom backends (databases, APIs, etc.).\n\n## Location\n`src/pmd/sources/entity.py`\n\n## URI Format\n`entity://\u003cresolver\u003e/\u003cresource-type\u003e/\u003cid\u003e[?query]`\n\nExamples:\n- `entity://postgres/articles/123`\n- `entity://notion/pages/abc-def`\n- `entity://custom/projects/42/docs`\n\n## Design\n```python\nclass EntityResolver(Protocol):\n    \"\"\"Protocol for entity resolvers.\"\"\"\n    \n    def list_entities(self, resource_type: str, query: dict) -\u003e Iterator[EntityInfo]:\n        \"\"\"List available entities.\"\"\"\n        ...\n    \n    async def fetch_entity(self, resource_type: str, entity_id: str) -\u003e EntityContent:\n        \"\"\"Fetch entity content.\"\"\"\n        ...\n\nclass EntityResolverRegistry:\n    \"\"\"Registry for entity resolvers.\"\"\"\n    _resolvers: dict[str, EntityResolver]\n    \n    def register(self, name: str, resolver: EntityResolver) -\u003e None\n    def get(self, name: str) -\u003e EntityResolver | None\n\nclass EntitySource:\n    \"\"\"Document source backed by entity resolvers.\"\"\"\n    \n    def __init__(self, uri: str, resolver_registry: EntityResolverRegistry):\n        self.resolver_name, self.resource_type, self.query = parse_entity_uri(uri)\n        self.resolver = resolver_registry.get(self.resolver_name)\n```\n\n## Built-in Resolvers\n- None initially (users register their own)\n- Document how to create custom resolvers\n\n## Example Custom Resolver\n```python\nclass PostgresResolver:\n    def __init__(self, conn_string: str, content_column: str = 'body'):\n        ...\n    \n    async def fetch_entity(self, table: str, id: str) -\u003e EntityContent:\n        row = await self.db.fetchone(f'SELECT * FROM {table} WHERE id = ', id)\n        return EntityContent(\n            content=row[self.content_column],\n            title=row.get('title'),\n            metadata={'updated_at': row['updated_at']}\n        )\n```","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T20:54:22.691489-05:00","updated_at":"2025-12-29T21:47:52.979428-05:00","closed_at":"2025-12-29T21:47:52.979428-05:00","dependencies":[{"issue_id":"qmd-lb1","depends_on_id":"qmd-b2n","type":"blocks","created_at":"2025-12-29T20:56:43.058725-05:00","created_by":"mike"},{"issue_id":"qmd-lb1","depends_on_id":"qmd-bpz","type":"blocks","created_at":"2025-12-29T20:56:48.22296-05:00","created_by":"mike"}]}
{"id":"qmd-n36","title":"Implement hybrid search pipeline","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T14:17:42.831392-05:00","updated_at":"2025-12-27T14:20:55.215346-05:00","closed_at":"2025-12-27T14:20:55.215346-05:00","dependencies":[{"issue_id":"qmd-n36","depends_on_id":"qmd-1y5","type":"blocks","created_at":"2025-12-27T14:18:07.827254-05:00","created_by":"mike"}]}
{"id":"qmd-nnm","title":"Document Source Abstraction - Multi-URI Support","description":"Enable sourcing documents from multiple backends: filesystem (current), HTTP URLs, and custom entity URIs.\n\n## Goals\n- Abstract document sourcing behind a protocol/interface\n- Support http:// and https:// URLs\n- Support custom entity:// URI schemes with pluggable resolvers\n- Maintain backward compatibility with existing filesystem collections\n\n## Key Components\n1. DocumentSource protocol\n2. Source registry with URI scheme routing\n3. FileSystemSource (refactor existing code)\n4. HTTPSource with caching/auth support\n5. EntitySource with resolver registry\n6. Collection model updates for source config\n7. Metadata tracking for remote sources","status":"closed","priority":2,"issue_type":"epic","created_at":"2025-12-29T20:51:36.963767-05:00","updated_at":"2025-12-29T22:14:32.844567-05:00","closed_at":"2025-12-29T22:14:32.844567-05:00"}
{"id":"qmd-p5e","title":"Refactor IndexingService to use DocumentSource","description":"Update IndexingService to delegate to DocumentSource implementations.\n\n## Current Flow\n```\nindex_collection(name)\n  -\u003e Path(collection.pwd).glob(pattern)\n  -\u003e open(file).read()\n  -\u003e document_repo.add_or_update()\n```\n\n## New Flow\n```\nindex_collection(name)\n  -\u003e source = registry.resolve(collection.source_uri, collection.source_config)\n  -\u003e for ref in source.list_documents():\n       if force or await source.check_modified(ref, stored_hash):\n         content = await source.fetch_content(ref)\n         document_repo.add_or_update(...)\n         metadata_repo.upsert(...)\n```\n\n## Changes to IndexingService\n1. Inject SourceRegistry in constructor\n2. Create source instance from collection config\n3. Use source.list_documents() instead of glob\n4. Use source.fetch_content() instead of open()\n5. Track source metadata for remote sources\n\n## Preserve\n- Title extraction logic (move to utility or keep in service)\n- FTS indexing logic\n- Embedding generation flow\n- Error handling and logging","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T20:54:53.044471-05:00","updated_at":"2025-12-29T21:31:27.0095-05:00","closed_at":"2025-12-29T21:31:27.0095-05:00","dependencies":[{"issue_id":"qmd-p5e","depends_on_id":"qmd-gwd","type":"blocks","created_at":"2025-12-29T20:56:53.376941-05:00","created_by":"mike"},{"issue_id":"qmd-p5e","depends_on_id":"qmd-bpz","type":"blocks","created_at":"2025-12-29T20:56:58.46007-05:00","created_by":"mike"},{"issue_id":"qmd-p5e","depends_on_id":"qmd-7g4","type":"blocks","created_at":"2025-12-29T20:57:03.607234-05:00","created_by":"mike"}]}
{"id":"qmd-pno","title":"Create StatusService for index health reporting","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T18:39:13.410436-05:00","updated_at":"2025-12-29T18:47:03.705897-05:00","closed_at":"2025-12-29T18:47:03.705897-05:00","dependencies":[{"issue_id":"qmd-pno","depends_on_id":"qmd-q74","type":"blocks","created_at":"2025-12-29T18:42:36.066334-05:00","created_by":"mike"}]}
{"id":"qmd-psy","title":"Define integration test cases for pmd.store module","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T18:10:58.093161-05:00","updated_at":"2025-12-27T18:12:00.0184-05:00","closed_at":"2025-12-27T18:12:00.0184-05:00"}
{"id":"qmd-q74","title":"Create ServiceContainer with lifecycle management","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T18:38:44.561482-05:00","updated_at":"2025-12-29T18:44:44.444436-05:00","closed_at":"2025-12-29T18:44:44.444436-05:00"}
{"id":"qmd-qno","title":"Add authentication/credentials abstraction","description":"Create a secure way to handle credentials for remote sources.\n\n## Location\n`src/pmd/sources/auth.py`\n\n## Design\n```python\nclass CredentialProvider(Protocol):\n    \"\"\"Protocol for credential providers.\"\"\"\n    \n    async def get_credential(self, key: str) -\u003e str | None:\n        \"\"\"Retrieve a credential by key.\"\"\"\n        ...\n\nclass EnvironmentCredentials:\n    \"\"\"Read credentials from environment variables.\"\"\"\n    \n    async def get_credential(self, key: str) -\u003e str | None:\n        return os.environ.get(key)\n\nclass KeyringCredentials:\n    \"\"\"Read credentials from system keyring.\"\"\"\n    \n    async def get_credential(self, key: str) -\u003e str | None:\n        import keyring\n        return keyring.get_password('pmd', key)\n\nclass ConfigFileCredentials:\n    \"\"\"Read credentials from encrypted config file.\"\"\"\n    ...\n```\n\n## Source Config Integration\n```python\n# In source config, reference credentials by key\n{\n    'base_url': 'https://api.example.com',\n    'auth_type': 'bearer',\n    'auth_token': '$ENV:API_TOKEN'  # or '$KEYRING:api-token'\n}\n```\n\n## Security Considerations\n- Never log or store plaintext credentials\n- Support credential rotation\n- Clear credentials from memory when done\n- Warn about insecure storage methods","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T20:55:23.069654-05:00","updated_at":"2025-12-29T21:38:54.04734-05:00","closed_at":"2025-12-29T21:38:54.04734-05:00"}
{"id":"qmd-rk0","title":"Implement query expansion","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T14:24:05.11009-05:00","updated_at":"2025-12-27T14:28:01.424416-05:00","closed_at":"2025-12-27T14:28:01.424416-05:00","dependencies":[{"issue_id":"qmd-rk0","depends_on_id":"qmd-5os","type":"blocks","created_at":"2025-12-27T14:24:35.174219-05:00","created_by":"mike"}]}
{"id":"qmd-sgg","title":"Add search and query CLI commands","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T14:17:47.982258-05:00","updated_at":"2025-12-27T14:21:55.982567-05:00","closed_at":"2025-12-27T14:21:55.982567-05:00","dependencies":[{"issue_id":"qmd-sgg","depends_on_id":"qmd-n36","type":"blocks","created_at":"2025-12-27T14:18:12.966733-05:00","created_by":"mike"}]}
{"id":"qmd-tuz","title":"Add CLI commands for new source types","description":"Extend CLI to support creating and managing collections with different source types.\n\n## New Commands\n\n### collection add (extended)\n```bash\n# Filesystem (existing, unchanged)\npmd collection add my-docs /path/to/docs --glob '**/*.md'\n\n# HTTP source\npmd collection add web-docs --source=http \\\n  --url='https://docs.example.com' \\\n  --sitemap='https://docs.example.com/sitemap.xml' \\\n  --auth=bearer --token='$DOCS_TOKEN'\n\n# Entity source  \npmd collection add db-docs --source=entity \\\n  --uri='entity://postgres/articles' \\\n  --config='connection_string=...'\n```\n\n### collection show (new)\n```bash\npmd collection show my-docs\n# Output:\n# Collection: my-docs\n#   Source: filesystem\n#   Path: /path/to/docs\n#   Pattern: **/*.md\n#   Documents: 42\n#   Last indexed: 2024-01-15T10:30:00Z\n```\n\n### source (new subcommand)\n```bash\n# List available source types\npmd source list\n\n# Test source connectivity\npmd source test --url='https://docs.example.com'\n\n# Register custom entity resolver (via config file)\npmd source register postgres --config=postgres.toml\n```\n\n## Implementation\n- Update argument parser in cli/commands/collection.py\n- Add cli/commands/source.py for source management\n- Validate source config before creating collection","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T20:55:08.032514-05:00","updated_at":"2025-12-29T21:45:08.759516-05:00","closed_at":"2025-12-29T21:45:08.759516-05:00","dependencies":[{"issue_id":"qmd-tuz","depends_on_id":"qmd-p5e","type":"blocks","created_at":"2025-12-29T20:57:08.708799-05:00","created_by":"mike"},{"issue_id":"qmd-tuz","depends_on_id":"qmd-5ms","type":"blocks","created_at":"2025-12-29T20:57:13.872672-05:00","created_by":"mike"}]}
{"id":"qmd-u9q","title":"Update pipeline to generate query embeddings for vector search","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T17:40:01.93655-05:00","updated_at":"2025-12-27T17:48:06.08566-05:00","closed_at":"2025-12-27T17:48:06.08566-05:00","dependencies":[{"issue_id":"qmd-u9q","depends_on_id":"qmd-xw0","type":"blocks","created_at":"2025-12-27T17:40:26.124529-05:00","created_by":"mike"}]}
{"id":"qmd-ukh","title":"Fix FTS5 reindex_collection to work with contentless tables","description":"","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-27T19:07:05.007959-05:00","updated_at":"2025-12-27T19:48:37.626408-05:00","closed_at":"2025-12-27T19:48:37.626408-05:00"}
{"id":"qmd-vas","title":"Add title-only document detection helper","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-28T23:02:22.933351-05:00","updated_at":"2025-12-28T23:36:56.3233-05:00","closed_at":"2025-12-28T23:36:56.3233-05:00"}
{"id":"qmd-vhe","title":"Implement CollectionRepository for CRUD operations","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T14:09:00.284046-05:00","updated_at":"2025-12-27T14:14:20.493337-05:00","closed_at":"2025-12-27T14:14:20.493337-05:00","dependencies":[{"issue_id":"qmd-vhe","depends_on_id":"qmd-z3k","type":"blocks","created_at":"2025-12-27T14:09:32.144582-05:00","created_by":"mike"}]}
{"id":"qmd-vsb","title":"Skip embeddings for title-only docs","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-28T23:02:31.044575-05:00","updated_at":"2025-12-28T23:37:58.852558-05:00","closed_at":"2025-12-28T23:37:58.852558-05:00","dependencies":[{"issue_id":"qmd-vsb","depends_on_id":"qmd-vas","type":"blocks","created_at":"2025-12-28T23:03:31.41699-05:00","created_by":"mike"}]}
{"id":"qmd-waq","title":"Implement DocumentRepository and content-addressable storage","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T14:09:05.673343-05:00","updated_at":"2025-12-27T14:15:10.553123-05:00","closed_at":"2025-12-27T14:15:10.553123-05:00","dependencies":[{"issue_id":"qmd-waq","depends_on_id":"qmd-z3k","type":"blocks","created_at":"2025-12-27T14:09:37.532783-05:00","created_by":"mike"}]}
{"id":"qmd-wt2","title":"Add document indexing CLI commands","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T14:17:53.106199-05:00","updated_at":"2025-12-27T14:22:50.426274-05:00","closed_at":"2025-12-27T14:22:50.426274-05:00","dependencies":[{"issue_id":"qmd-wt2","depends_on_id":"qmd-dum","type":"blocks","created_at":"2025-12-27T14:18:18.105441-05:00","created_by":"mike"}]}
{"id":"qmd-wvv","title":"Implement document reranking with LLM","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T14:24:10.239063-05:00","updated_at":"2025-12-27T14:28:38.046689-05:00","closed_at":"2025-12-27T14:28:38.046689-05:00","dependencies":[{"issue_id":"qmd-wvv","depends_on_id":"qmd-5os","type":"blocks","created_at":"2025-12-27T14:24:40.315365-05:00","created_by":"mike"}]}
{"id":"qmd-xco","title":"Add sqlite-vec extension and vector table to schema","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T17:39:45.500849-05:00","updated_at":"2025-12-27T17:42:09.981435-05:00","closed_at":"2025-12-27T17:42:09.981435-05:00"}
{"id":"qmd-xw0","title":"Implement vector similarity search in search_vec()","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T17:39:56.393371-05:00","updated_at":"2025-12-27T17:46:41.19898-05:00","closed_at":"2025-12-27T17:46:41.19898-05:00","dependencies":[{"issue_id":"qmd-xw0","depends_on_id":"qmd-56o","type":"blocks","created_at":"2025-12-27T17:40:20.943708-05:00","created_by":"mike"}]}
{"id":"qmd-y96","title":"Set up project structure and pyproject.toml","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T14:08:49.487393-05:00","updated_at":"2025-12-27T14:12:03.412889-05:00","closed_at":"2025-12-27T14:12:03.412889-05:00"}
{"id":"qmd-yvl","title":"Implement OpenRouter LLM provider","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T14:23:54.808903-05:00","updated_at":"2025-12-27T14:26:41.932354-05:00","closed_at":"2025-12-27T14:26:41.932354-05:00"}
{"id":"qmd-z3k","title":"Implement Database class and schema","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T14:08:54.889411-05:00","updated_at":"2025-12-27T14:13:37.427839-05:00","closed_at":"2025-12-27T14:13:37.427839-05:00","dependencies":[{"issue_id":"qmd-z3k","depends_on_id":"qmd-y96","type":"blocks","created_at":"2025-12-27T14:09:26.769573-05:00","created_by":"mike"}]}
